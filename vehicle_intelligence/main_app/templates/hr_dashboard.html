{% extends 'base.html' %}

{% block title %}HR Dashboard - Vehicle Intelligence System{% endblock %}

{% block page_title_text %}HR Dashboard{% endblock %}
{% block page_subtitle %}Human Resources Management & Analytics{% endblock %}

{% block extra_css %}
<style>
    /* HR Dashboard Specific Styles */
    .hr-dashboard {
        display: grid;
        gap: 25px;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        margin-bottom: 30px;
    }

    .dashboard-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
        border-radius: var(--radius-lg);
        padding: 25px;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-green);
        transition: all var(--transition-normal);
        position: relative;
        overflow: hidden;
    }

    .dashboard-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--primary-gradient);
        border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-green);
    }

    .card-title {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 18px;
        font-weight: 700;
        color: var(--text-dark);
    }

    .card-icon {
        width: 40px;
        height: 40px;
        background: var(--primary-gradient);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 18px;
        box-shadow: var(--shadow-green);
    }

    .card-action {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: var(--radius-sm);
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-normal);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .card-action:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
    }

    /* Statistics Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: linear-gradient(135deg, var(--accent-white) 0%, var(--primary-super-light) 100%);
        border-radius: var(--radius-lg);
        padding: 20px;
        text-align: center;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-green);
        transition: all var(--transition-normal);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(76, 175, 80, 0.05) 0%, transparent 70%);
        animation: float 10s ease-in-out infinite;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
    }

    .stat-number {
        font-size: 32px;
        font-weight: 800;
        color: var(--primary-dark);
        margin-bottom: 8px;
        position: relative;
        z-index: 1;
    }

    .stat-label {
        font-size: 14px;
        color: var(--text-medium);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
        z-index: 1;
    }

    .stat-change {
        font-size: 12px;
        margin-top: 5px;
        padding: 4px 8px;
        border-radius: var(--radius-sm);
        font-weight: 600;
        position: relative;
        z-index: 1;
    }

    .stat-change.positive {
        background: rgba(46, 125, 50, 0.1);
        color: var(--success-green);
    }

    .stat-change.negative {
        background: rgba(211, 47, 47, 0.1);
        color: var(--danger-red);
    }

    /* Charts and Lists */
    .chart-container {
        height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-green-ultra-light);
        border-radius: var(--radius-md);
        margin-bottom: 15px;
        position: relative;
    }

    .chart-placeholder {
        text-align: center;
        color: var(--text-light);
        font-size: 14px;
    }

    .list-container {
        max-height: 400px;
        overflow-y: auto;
    }

    .list-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-green);
        transition: all var(--transition-fast);
    }

    .list-item:hover {
        background: var(--bg-green-light);
        margin: 0 -15px;
        padding: 12px 15px;
        border-radius: var(--radius-sm);
    }

    .list-item:last-child {
        border-bottom: none;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
    }

    .user-avatar {
        width: 36px;
        height: 36px;
        background: var(--primary-gradient);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 14px;
        flex-shrink: 0;
    }

    .user-details {
        flex: 1;
        min-width: 0;
    }

    .user-name {
        font-weight: 600;
        color: var(--text-dark);
        font-size: 14px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .user-role {
        font-size: 12px;
        color: var(--text-medium);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .user-meta {
        font-size: 12px;
        color: var(--text-light);
        text-align: right;
        flex-shrink: 0;
    }

    .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: var(--radius-sm);
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .badge-success {
        background: rgba(46, 125, 50, 0.1);
        color: var(--success-green);
    }

    .badge-warning {
        background: rgba(255, 152, 0, 0.1);
        color: var(--warning-orange);
    }

    .badge-danger {
        background: rgba(211, 47, 47, 0.1);
        color: var(--danger-red);
    }

    .badge-info {
        background: rgba(25, 118, 210, 0.1);
        color: var(--info-blue);
    }

    /* Progress Bars */
    .progress-container {
        margin: 15px 0;
    }

    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 14px;
        font-weight: 600;
    }

    .progress-bar {
        width: 100%;
        height: 8px;
        background: var(--border-green);
        border-radius: var(--radius-sm);
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: var(--primary-gradient);
        border-radius: var(--radius-sm);
        transition: width 1s ease;
        position: relative;
    }

    .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    /* Issues List */
    .issues-list {
        max-height: 350px;
        overflow-y: auto;
    }

    .issue-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 15px 0;
        border-bottom: 1px solid var(--border-green);
    }

    .issue-item:last-child {
        border-bottom: none;
    }

    .issue-avatar {
        width: 32px;
        height: 32px;
        background: var(--warning-gradient);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 12px;
        flex-shrink: 0;
    }

    .issue-content {
        flex: 1;
        min-width: 0;
    }

    .issue-user {
        font-weight: 600;
        color: var(--text-dark);
        font-size: 14px;
        margin-bottom: 4px;
    }

    .issue-list {
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .issue-list li {
        font-size: 12px;
        color: var(--text-medium);
        margin-bottom: 2px;
        position: relative;
        padding-left: 12px;
    }

    .issue-list li::before {
        content: '•';
        color: var(--warning-orange);
        position: absolute;
        left: 0;
    }

    /* Activity Timeline */
    .activity-timeline {
        max-height: 400px;
        overflow-y: auto;
    }

    .activity-item {
        display: flex;
        gap: 15px;
        padding: 15px 0;
        border-bottom: 1px solid var(--border-green);
        position: relative;
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-icon {
        width: 32px;
        height: 32px;
        background: var(--info-gradient);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 14px;
        flex-shrink: 0;
        position: relative;
        z-index: 1;
    }

    .activity-item:not(:last-child) .activity-icon::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        width: 2px;
        height: 30px;
        background: var(--border-green);
        z-index: -1;
    }

    .activity-content {
        flex: 1;
        min-width: 0;
    }

    .activity-description {
        font-size: 14px;
        color: var(--text-dark);
        font-weight: 500;
        margin-bottom: 4px;
    }

    .activity-meta {
        font-size: 12px;
        color: var(--text-light);
    }

    /* Export Dropdown */
    .export-dropdown {
        position: absolute;
        bottom: 100%;
        right: 0;
        min-width: 200px;
        background: white;
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border-green);
        z-index: 1000;
        overflow: hidden;
        margin-bottom: 5px;
    }

    .export-container {
        position: relative;
        display: inline-block;
        width: 100%;
    }

    .export-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 15px;
        color: var(--text-dark);
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: all var(--transition-fast);
        border-bottom: 1px solid var(--border-green);
    }

    .export-option:last-child {
        border-bottom: none;
    }

    .export-option:hover {
        background: var(--bg-green-light);
        color: var(--primary-dark);
    }

    .export-option i {
        width: 16px;
        text-align: center;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .hr-dashboard {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .dashboard-card {
            padding: 20px;
        }

        .card-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .chart-container {
            height: 250px;
        }

        .export-dropdown {
            position: fixed;
            top: auto;
            bottom: 20px;
            left: 20px;
            right: 20px;
            width: auto;
            min-width: auto;
        }

        .export-container {
            position: static;
        }
    }

    @media (max-width: 480px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .dashboard-card {
            padding: 15px;
        }

        .stat-number {
            font-size: 24px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- HR Statistics Overview -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number">{{ total_employees }}</div>
        <div class="stat-label">Total Employees</div>
        {% if total_employees > 0 %}
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i> Active Organization
        </div>
        {% endif %}
    </div>

    <div class="stat-card">
        <div class="stat-number">{{ active_employees }}</div>
        <div class="stat-label">Active Employees</div>
        {% if total_employees > 0 %}
        <div class="stat-change {% if active_employees == total_employees %}positive{% else %}negative{% endif %}">
            <i class="fas fa-{% if active_employees == total_employees %}check{% else %}exclamation-triangle{% endif %}"></i>
            {{ active_employees }}/{{ total_employees }} Active
        </div>
        {% endif %}
    </div>

    <div class="stat-card">
        <div class="stat-number">{{ profile_completion_rate }}%</div>
        <div class="stat-label">Profile Completion</div>
        <div class="stat-change {% if profile_completion_rate >= 80 %}positive{% elif profile_completion_rate >= 50 %}warning{% else %}negative{% endif %}">
            <i class="fas fa-{% if profile_completion_rate >= 80 %}check-circle{% elif profile_completion_rate >= 50 %}clock{% else %}exclamation-circle{% endif %}"></i>
            {% if profile_completion_rate >= 80 %}Excellent{% elif profile_completion_rate >= 50 %}Good{% else %}Needs Attention{% endif %}
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-number">{{ total_documents }}</div>
        <div class="stat-label">Total Documents</div>
        {% if total_documents > 0 %}
        <div class="stat-change {% if verified_documents == total_documents %}positive{% else %}warning{% endif %}">
            <i class="fas fa-{% if verified_documents == total_documents %}shield-alt{% else %}clock{% endif %}"></i>
            {{ verified_documents }} Verified
        </div>
        {% endif %}
    </div>
</div>

<!-- Main Dashboard Grid -->
<div class="hr-dashboard">
    <!-- All Organizations -->
    {% if user.role == 'super_admin' %}
    <div class="dashboard-card">
        <div class="card-header">
            <div class="card-title">
                <div class="card-icon">
                    <i class="fas fa-building"></i>
                </div>
                All Organizations
            </div>
            <a href="{% url 'super_admin_organizations' %}" class="card-action">
                <i class="fas fa-eye"></i>
                Manage
            </a>
        </div>

        {% if org_stats %}
        <div class="list-container">
            {% for org_name, user_count in org_stats.items %}
            <div class="list-item">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="user-details">
                        <div class="user-name">{{ org_name }}</div>
                        <div class="user-role">{{ user_count }} employee{{ user_count|pluralize }}</div>
                    </div>
                </div>
                <div class="user-meta">
                    <span class="badge badge-info">{{ user_count }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="chart-placeholder">
            <i class="fas fa-building" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
            <p>No organizations found</p>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Role Distribution -->
    <div class="dashboard-card">
        <div class="card-header">
            <div class="card-title">
                <div class="card-icon">
                    <i class="fas fa-users"></i>
                </div>
                Role Distribution
            </div>
            <a href="#" class="card-action">
                <i class="fas fa-chart-pie"></i>
                View Details
            </a>
        </div>

        {% if role_stats %}
        <div class="list-container">
            {% for role, count in role_stats.items %}
            <div class="list-item">
                <div class="user-info">
                    <div class="user-avatar">
                        {% if 'Admin' in role %}<i class="fas fa-crown"></i>
                        {% elif 'Manager' in role %}<i class="fas fa-user-tie"></i>
                        {% elif 'HR' in role %}<i class="fas fa-users-cog"></i>
                        {% elif 'Sales' in role %}<i class="fas fa-handshake"></i>
                        {% else %}<i class="fas fa-user"></i>{% endif %}
                    </div>
                    <div class="user-details">
                        <div class="user-name">{{ role }}</div>
                        <div class="user-role">{{ count }} employee{{ count|pluralize }}</div>
                    </div>
                </div>
                <div class="user-meta">
                    <span class="badge badge-info">{{ count }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="chart-placeholder">
            <i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
            <p>No role data available</p>
        </div>
        {% endif %}
    </div>

    <!-- Department Distribution -->
    <div class="dashboard-card">
        <div class="card-header">
            <div class="card-title">
                <div class="card-icon">
                    <i class="fas fa-building"></i>
                </div>
                Department Breakdown
            </div>
            <a href="#" class="card-action">
                <i class="fas fa-list"></i>
                Manage
            </a>
        </div>

        {% if dept_stats %}
        <div class="list-container">
            {% for dept, count in dept_stats.items %}
            <div class="list-item">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <div class="user-details">
                        <div class="user-name">{{ dept|title }}</div>
                        <div class="user-role">{{ count }} member{{ count|pluralize }}</div>
                    </div>
                </div>
                <div class="user-meta">
                    <span class="badge badge-success">{{ count }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="chart-placeholder">
            <i class="fas fa-building" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
            <p>No department data available</p>
        </div>
        {% endif %}
    </div>

    <!-- Recent Hires -->
    <div class="dashboard-card">
        <div class="card-header">
            <div class="card-title">
                <div class="card-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                Recent Hires (30 Days)
            </div>
            <a href="{% url 'add_user' %}" class="card-action">
                <i class="fas fa-plus"></i>
                Add Employee
            </a>
        </div>

        {% if recent_hires %}
        <div class="list-container">
            {% for user in recent_hires %}
            <div class="list-item">
                <div class="user-info">
                    <div class="user-avatar">
                        {{ user.first_name|first|upper|default:"U" }}{{ user.last_name|first|upper|default:"" }}
                    </div>
                    <div class="user-details">
                        <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
                        <div class="user-role">{{ user.get_role_display }} • {{ user.department|default:"No Department" }}</div>
                    </div>
                </div>
                <div class="user-meta">
                    {{ user.date_joined|timesince }} ago
                    <br>
                    <span class="badge badge-success">New</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="chart-placeholder">
            <i class="fas fa-user-plus" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
            <p>No recent hires in the last 30 days</p>
        </div>
        {% endif %}
    </div>

    <!-- Users Needing Attention -->
    <div class="dashboard-card">
        <div class="card-header">
            <div class="card-title">
                <div class="card-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                Attention Required
            </div>
            <a href="#" class="card-action">
                <i class="fas fa-tools"></i>
                Fix Issues
            </a>
        </div>

        {% if users_needing_attention %}
        <div class="issues-list">
            {% for item in users_needing_attention %}
            <div class="issue-item">
                <div class="issue-avatar">
                    {{ item.user.first_name|first|upper|default:"U" }}{{ item.user.last_name|first|upper|default:"" }}
                </div>
                <div class="issue-content">
                    <div class="issue-user">{{ item.user.get_full_name|default:item.user.username }}</div>
                    <ul class="issue-list">
                        {% for issue in item.issues %}
                        <li>{{ issue }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="chart-placeholder">
            <i class="fas fa-check-circle" style="font-size: 48px; margin-bottom: 15px; color: var(--success-green); opacity: 0.7;"></i>
            <p>All employee profiles are complete!</p>
        </div>
        {% endif %}
    </div>

    <!-- Profile Completion Progress -->
    <div class="dashboard-card">
        <div class="card-header">
            <div class="card-title">
                <div class="card-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                Profile Completion
            </div>
            <a href="#" class="card-action">
                <i class="fas fa-eye"></i>
                View All
            </a>
        </div>

        <div class="progress-container">
            <div class="progress-label">
                <span>Overall Completion</span>
                <span>{{ profile_completion_rate }}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ profile_completion_rate }}%"></div>
            </div>
        </div>

        {% if total_documents > 0 %}
        <div class="progress-container">
            <div class="progress-label">
                <span>Document Verification</span>
                <span>{{ verified_documents }}/{{ total_documents }}</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {% widthratio verified_documents total_documents 100 %}%"></div>
            </div>
        </div>
        {% endif %}

        <div class="progress-container">
            <div class="progress-label">
                <span>Active Employees</span>
                <span>{{ active_employees }}/{{ total_employees }}</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {% if total_employees > 0 %}{% widthratio active_employees total_employees 100 %}{% else %}0{% endif %}%"></div>
            </div>
        </div>
    </div>

    <!-- Recent HR Activities -->
    <div class="dashboard-card">
        <div class="card-header">
            <div class="card-title">
                <div class="card-icon">
                    <i class="fas fa-history"></i>
                </div>
                Recent Activities
            </div>
            <a href="#" class="card-action">
                <i class="fas fa-list"></i>
                View All
            </a>
        </div>

        {% if recent_activities %}
        <div class="activity-timeline">
            {% for activity in recent_activities %}
            <div class="activity-item">
                <div class="activity-icon">
                    {% if activity.action == 'create' %}<i class="fas fa-plus"></i>
                    {% elif activity.action == 'update' %}<i class="fas fa-edit"></i>
                    {% elif activity.action == 'delete' %}<i class="fas fa-trash"></i>
                    {% elif activity.action == 'view' %}<i class="fas fa-eye"></i>
                    {% else %}<i class="fas fa-cog"></i>{% endif %}
                </div>
                <div class="activity-content">
                    <div class="activity-description">{{ activity.description }}</div>
                    <div class="activity-meta">
                        {{ activity.user.get_full_name|default:activity.user.username }} • {{ activity.timestamp|timesince }} ago
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="chart-placeholder">
            <i class="fas fa-history" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
            <p>No recent HR activities</p>
        </div>
        {% endif %}
    </div>

    <!-- All Employees List -->
    <div class="dashboard-card" style="grid-column: 1 / -1;">
        <div class="card-header">
            <div class="card-title">
                <div class="card-icon">
                    <i class="fas fa-users"></i>
                </div>
                All Employees (Latest 50)
            </div>
            <a href="#" class="card-action">
                <i class="fas fa-list"></i>
                View All
            </a>
        </div>

        {% if all_users %}
        <div class="list-container" style="max-height: 500px;">
            {% for user in all_users %}
            <div class="list-item">
                <div class="user-info">
                    <div class="user-avatar">
                        {{ user.first_name|first|upper|default:"U" }}{{ user.last_name|first|upper|default:"" }}
                    </div>
                    <div class="user-details">
                        <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
                        <div class="user-role">
                            {{ user.get_role_display }}
                            {% if user.organization %} • {{ user.organization.name }}{% endif %}
                            {% if user.department %} • {{ user.department }}{% endif %}
                        </div>
                    </div>
                </div>
                <div class="user-meta">
                    <div style="text-align: right; font-size: 12px;">
                        <div>{{ user.email }}</div>
                        <div style="margin-top: 4px;">
                            <span class="badge {% if user.is_active %}badge-success{% else %}badge-danger{% endif %}">
                                {% if user.is_active %}Active{% else %}Inactive{% endif %}
                            </span>
                        </div>
                        <div style="margin-top: 4px; color: var(--text-light);">
                            Joined: {{ user.date_joined|date:"M d, Y" }}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="chart-placeholder">
            <i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
            <p>No employees found</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Quick Actions -->
<div class="dashboard-card" style="grid-column: 1 / -1;">
    <div class="card-header">
        <div class="card-title">
            <div class="card-icon">
                <i class="fas fa-bolt"></i>
            </div>
            Quick Actions
        </div>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        {% if user.role == 'organization_admin' %}
        <a href="{% url 'add_user' %}" class="card-action" style="padding: 15px; text-align: center; text-decoration: none; display: block;">
            <i class="fas fa-user-plus" style="display: block; margin-bottom: 8px; font-size: 20px;"></i>
            Add New Employee
        </a>
        {% endif %}

        <a href="{% url 'profile_view' %}" class="card-action" style="padding: 15px; text-align: center; text-decoration: none; display: block;">
            <i class="fas fa-users" style="display: block; margin-bottom: 8px; font-size: 20px;"></i>
            View All Profiles
        </a>

        <div class="export-container">
            <a href="#" id="exportBtn" class="card-action" style="padding: 15px; text-align: center; text-decoration: none; display: block; background: var(--primary-gradient); color: white; border-radius: var(--radius-md);">
                <i class="fas fa-file-export" style="display: block; margin-bottom: 8px; font-size: 20px;"></i>
                Export HR Report
            </a>
            <div id="exportDropdown" class="export-dropdown" style="display: none;">
                <a href="{% url 'export_hr_report' %}?format=csv" class="export-option">
                    <i class="fas fa-file-csv"></i> Export as CSV
                </a>
                <a href="{% url 'export_hr_report' %}?format=pdf" class="export-option">
                    <i class="fas fa-file-pdf"></i> Export as PDF
                </a>
            </div>
        </div>

        <a href="{% url 'hr_settings' %}" class="card-action" style="padding: 15px; text-align: center; text-decoration: none; display: block;">
            <i class="fas fa-cog" style="display: block; margin-bottom: 8px; font-size: 20px;"></i>
            HR Settings
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate progress bars
    const progressBars = document.querySelectorAll('.progress-fill');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 500);
    });

    // Animate stat numbers
    const statNumbers = document.querySelectorAll('.stat-number');
    statNumbers.forEach(stat => {
        const finalValue = parseInt(stat.textContent);
        let currentValue = 0;
        const increment = finalValue / 50;
        const timer = setInterval(() => {
            currentValue += increment;
            if (currentValue >= finalValue) {
                stat.textContent = finalValue;
                clearInterval(timer);
            } else {
                stat.textContent = Math.floor(currentValue);
            }
        }, 30);
    });

    // Add hover effects to cards
    const cards = document.querySelectorAll('.dashboard-card, .stat-card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });

    // Export dropdown functionality
    const exportBtn = document.getElementById('exportBtn');
    const exportDropdown = document.getElementById('exportDropdown');
    
    if (exportBtn && exportDropdown) {
        exportBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            exportDropdown.style.display = exportDropdown.style.display === 'none' ? 'block' : 'none';
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!exportBtn.contains(e.target) && !exportDropdown.contains(e.target)) {
                exportDropdown.style.display = 'none';
            }
        });
        
        // Handle export clicks
        const exportOptions = exportDropdown.querySelectorAll('.export-option');
        exportOptions.forEach(option => {
            option.addEventListener('click', function() {
                exportDropdown.style.display = 'none';
                // Show loading message
                showToast('Generating report...', 'info');
            });
        });
    }
    
    // Auto-refresh data every 5 minutes
    setInterval(() => {
        console.log('Auto-refreshing HR dashboard data...');
    }, 300000);
    
    // Toast notification function
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
            <div class="toast-content">
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            </div>
        `;
        
        toast.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: ${type === 'success' ? 'var(--success-green)' : type === 'error' ? 'var(--danger-red)' : type === 'warning' ? 'var(--warning-orange)' : 'var(--info-blue)'};
            color: white;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            animation: fadeIn 0.3s ease;
            max-width: 300px;
            font-size: 14px;
        `;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
});
</script>
{% endblock %}